# FraudGuard   
ML-модель для детектирования мошеннических транзакций

## Описание

FraudGuard — проект на Python для выявления мошеннических транзакций по данным о платёжных операциях.  
Модель по признакам транзакции (сумма, тип операции, балансы до/после и т.п.) предсказывает, является ли она мошеннической (`isFraud = 1`) или нормальной (`isFraud = 0`).

Проект включает:

- обработку и анализ табличных данных (pandas),
- построение признаков и препроцессинг (scikit-learn Pipelines, ColumnTransformer),
- работу с несбалансированным классом (`isFraud` встречается редко),
- обучение и оценку нескольких моделей,
- автотесты (pytest),
- простой прототип веб-сервиса для проверки транзакций (Streamlit).

---

## Датасет

Используется публичный анонимизированный датасет транзакций онлайн-платежей.

Ключевые поля:

- `step` — шаг времени (например, часы с начала наблюдения),
- `type` — тип транзакции (`PAYMENT`, `CASH_OUT`, `TRANSFER` и др.),
- `amount` — сумма операции,
- `nameOrig` / `nameDest` — зашифрованные идентификаторы счёта отправителя и получателя,
- `oldbalanceOrg`, `newbalanceOrg` — баланс отправителя до и после операции,
- `oldbalanceDest`, `newbalanceDest` — баланс получателя до и после операции,
- `isFraud` — целевой признак (1 — мошенничество, 0 — нормальная операция).

CSV-файл с данными ожидается по пути:

```text
data/raw/transactions.csv
```

---

## Структура проекта

```text
FraudGuard/
  fraudguard/
    __init__.py
    data.py         # загрузка данных и train/valid/test split
    features.py     # генерация признаков, препроцессинг (ColumnTransformer)
    models.py       # конструкторы моделей (LogReg, RandomForest)
    evaluate.py     # расчёт метрик и текстовые отчёты
  scripts/
    __init__.py
    train.py        # обучение и сохранение модели
    predict.py      # CLI для единичного предсказания
  app/
    app.py          # Streamlit-приложение
  data/
    raw/
      transactions.csv
    processed/      # (опционально, для сохранения обработанных данных)
  models/
    fraud_model.joblib  # сохранённая модель
  tests/
    test_features.py    # тесты на препроцессинг и фичи
    test_models.py      # тесты на базовое обучение и предсказание моделей
  pytest.ini
  requirements.txt
  README.md
```

---

## Технологии

- **Язык:** Python 3.x  
- **ML / данные:** `pandas`, `numpy`, `scikit-learn`, `imbalanced-learn`  
- **Визуализация:** `matplotlib`, `seaborn` 
- **Инференс / сервис:** `Streamlit`  
- **Инфраструктура:** `pytest` (тесты), `joblib` (сохранение моделей)

---

## Установка

Клонирование репозитория и создание виртуального окружения:

```bash
git clone <url-репозитория> FraudGuard
cd FraudGuard

python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

Установка зависимостей:

```bash
pip install -r requirements.txt
```

Подготовка данных:

```bash
mkdir -p data/raw
# файл с данными переименовать в transactions.csv
# и поместить в data/raw/transactions.csv
```

---

## Данные

Файл с данными **не хранится в репозитории** из-за ограничений GitHub по размеру (100 MB на файл).  
Для работы проекта нужно самостоятельно скачать датасет и положить его в нужную папку.

1. Скачайте публичный датасет транзакций онлайн-платежей (например, с Kaggle).
2. Переименуйте файл в:

   ```text
   transactions.csv


## Обучение модели

Запуск обучения (из корня проекта):

```bash
source venv/bin/activate
python -m scripts.train
```

Сценарий выполняет:

1. Загрузку `data/raw/transactions.csv`.
2. Разделение на выборки `train/valid/test` со стратификацией по `isFraud`.
3. Построение препроцессора (`ColumnTransformer` для числовых и категориальных признаков).
4. Обучение двух моделей:
   - Logistic Regression (`class_weight="balanced"`),
   - RandomForestClassifier (`class_weight="balanced_subsample"`).
5. Расчёт метрик на валидационной выборке:
   - confusion matrix,
   - classification report (precision, recall, F1),
   - ROC-AUC,
   - PR-AUC.
6. Сохранение обученной модели в:

```text
models/fraud_model.joblib
```

---

## Модель

Обученная модель (`fraud_model.joblib`) также не хранится в репозитории и создаётся локально при запуске:

```bash
python -m scripts.train
```


## Использование модели из командной строки

Пример вызова CLI для единичного предсказания:

```bash
python -m scripts.predict \
  --amount 123.45 \
  --transaction_type "PAYMENT" \
  --device_type "mobile" \
  --transaction_time "2025-01-01 12:34:56"
```

Скрипт:

1. Формирует одну транзакцию в виде `DataFrame`.
2. Применяет те же преобразования признаков, что и при обучении.
3. Загружает модель из `models/fraud_model.joblib`.
4. Выводит:
   - вероятность мошенничества,
   - бинарное предсказание (`0` — нормальная, `1` — подозрительная).

---

## Streamlit-приложение

Запуск веб-интерфейса:

```bash
streamlit run app/app.py
```

В интерфейсе можно:

- задать параметры транзакции (сумма, тип, устройство, время),
- получить оценку вероятности мошенничества,
- увидеть текстовую интерпретацию результата.

---

## Тесты

Запуск автотестов:

```bash
pytest
# или
python -m pytest
```

Содержимое тестов:

- `tests/test_features.py`:
  - проверка работы `add_basic_features` на небольшом DataFrame,
  - проверка корректной разметки числовых и категориальных признаков в `build_preprocessor`,
  - проверка того, что таргет `isFraud` не попадает в список признаков.

- `tests/test_models.py`:
  - обучение логистической регрессии и случайного леса на небольшом синтетическом датасете,
  - проверка размера и диапазона предсказаний (`0/1`).

---

## Возможные направления развития

- Добавление бустинга (XGBoost / LightGBM / CatBoost) и сравнение с текущими моделями.
- Эксперименты со стратегиями работы с дисбалансом:
  - `class_weight`, undersampling, oversampling, SMOTE.
- Вынос гиперпараметров моделей и путей к данным в конфигурационный файл (`.yaml` / `.json`).
- Добавление ноутбука `notebooks/01_eda.ipynb` с исследовательским анализом данных.
- Подключение интерпретации модели (SHAP / permutation importance) и анализ влияния признаков.
- Настройка CI (GitHub Actions) для автоматического запуска тестов при изменениях в коде.
